<!doctype html>
<html lang="fr"><head>
   <!-- Required meta tags -->
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="description" content="sulfur,business,company,agency,multipurpose,modern,bootstrap4">
   <meta name="theme-name" content="enov-bulma" />

   <title>PPE</title>

   <!-- bootstrap.min css -->
   <link rel="stylesheet" href="plugins/bulma/bulma.min.css">
   <!-- Icon Font Css -->
   <link rel="stylesheet" href="plugins/themify/css/themify-icons.css">
   <link rel="stylesheet" href="plugins/fontawesome/css/all.css">
   <!-- AOS css -->
   <link rel="stylesheet" href="plugins/animate-css/animate.css">
   <link rel="stylesheet" href="plugins/aos/aos.css">
   <link rel="stylesheet" href="plugins/magnific-popup/dist/magnific-popup.css">
   <link rel="stylesheet" href="plugins/modal-video/modal-video.min.css">
   <!-- Owl Carousel CSS -->
   <link rel="stylesheet" href="plugins/slick-carousel/slick/slick.css">
   <link rel="stylesheet" href="plugins/slick-carousel/slick/slick-theme.css">

   <!-- Main Stylesheet -->
   <link rel="stylesheet" href="css/style.css">
   <script src="highlight.js"></script>
   <script src="highlight.min.js"></script>
   <link rel="stylesheet" href="styles/default.min.css">
   <script>hljs.initHighlightingOnLoad();</script>

</head>
<body>
<!-- navigation -->
<header class="navigation">
	<nav id="navbar" class="navbar main-nav">
		<div class="container">
			<div class="navbar-brand ml-0">
				<a class="navbar-item" href="index.html">
					<h2 class="has-text-white" style="font-size:2rem">PPE</h2>
				</a>
				<button role="button" class="navbar-burger burger" data-hidden="true" data-target="navigation">
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
				</button>
			</div>

			<div class="navbar-menu mr-0" id="navigation">
				<ul class="navbar-end">					 
					<li class="navbar-item">
						<a class="navbar-link is-arrowless" href="index.html">Home</a>
					</li>
					
					<li class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link is-arrowless">Extraction des URLS</a>
						<div class="navbar-dropdown">
							<a href="scripts.html" class="navbar-item"> Démarche </a>
                      <a href="tableau_fr.html" class="navbar-item"> Tableau Français </a>
                     <a href="tableau_all.html" class="navbar-item"> Tableau Allemand </a>
                     <a href="tableau_eng.html" class="navbar-item"> Tableau Anglais </a>
						</div>
					</li>
					
               <li class="navbar-item has-dropdown is-hoverable">
                  <a class="navbar-link is-arrowless">iTrameur</a>
                  <div class="navbar-dropdown">
                     <a href="demarche_itrameur.html" class="navbar-item"> Démarche </a>
                     <a href="itrameurfr.html" class="navbar-item"> Analyse français </a>
                     <a href="itrameurall.html" class="navbar-item"> Analyse allemand </a>
                     <a href="itrameureng.html" class="navbar-item"> Analyse anglais </a>
                  </div>
               </li>

               <li class="navbar-item has-dropdown is-hoverable">
                  <a class="navbar-link is-arrowless">Nuage de mots</a>
                  <div class="navbar-dropdown">
                     <a href="cloudfr.html" class="navbar-item"> Nuage français </a>
                     <a href="cloudall.html" class="navbar-item"> Nuages allemand </a>
                     <a href="cloudeng.html" class="navbar-item"> Nuages anglais </a>
                  </div>
               </li>

					<li class="navbar-item">
						<a class="navbar-link is-arrowless" href="analyse.html">Conclusion</a>
					</li>
					
					<li class="navbar-item">
						<a class="navbar-link is-arrowless" href="about.html">À propos de nous</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>
</header>
<!-- nav part end -->
<section class="page-title bg-1">
   <div class="container">
      <div class="columns">
         <div class="column is-12">
            <div class="has-text-centered">
               <!-- <p>News details</p> -->
               <h1 class="text-capitalize mb-4 text-lg">Aspiration des URLs </h1>
            </div>
         </div>
      </div>
   </div>
</section>

<!--Titre de section-->
<section class="section blog-wrap">
   <div class="container">
      <div class="columns is-desktop">
   <div class="column is-12">
      <div class="single-blog-item">
         <div class="has-text-centered">
            <span class="text-color text-sm letter-spacing is-uppercase mr-3">Extraction des données</span>
         </div>
         <h2 class="mt-1 mb-4 has-text-centered"><a href="scripts.html">Rédaction du script :</a></h2>
         <div class="blog-item-meta has-text-centered mb-5">
            <span class="is-uppercase text-sm letter-spacing"><i class="ti-time mr-1"></i>Décembre 2022</span>
         </div>
</div></div></div>
     
<!--  Section site base -->
<div class="box">
   <img class="scripimage" src="images/fox2.jpg" width="25%"/>  
</br></br>
<p> Nous avons réalisé 2 scripts différents pour la constitution de nos corpus. Ces scripts ont été réalisés durant les séances de cours et au fil de nos exercices personnels.</p>
<p>Ces deux scripts sont :</p>
<div class="content">
   <ul>
      <li> <b>scriptaspi.sh</b> : le script qui permet de créer les aspirations des pages qui nous intéressaient. Lors de l'exécution de ce script, un autre script est exécuté en parallèle :<ul>
         <li> <b>concordance.sh</b> qui permet de créer les concordances du motif recherché lors de l'exécution du script.</li></ul></li>
      </ul>
   </div>
   <br>
   Ici, nous allons nous intéresser à la rédaction des deux premiers scripts. La création du script <b>itrameurscript.sh</b> est explicitée dans la partie <i>iTrameur</i>.
</p>
<h3 class="quote">Rédaction des scripts :</h3>
     <p class="panel-heading">
       Script final :
     </p>
     <br>
<pre style=" height: 500px; width: 900px;display: block;
margin-left: auto;
margin-right: auto;"><code class="script Bash" >#!/usr/bin/env bash

   #===============================================================================
   # Ce script est notre programme pour traiter les URLs. Il permet de créer un tableau HTML en sortie avec chaque URL, le code de réponse correspondant .
   # Il s'utilise dans le dossier avec le fichier à traiter &lt;URL.txt&gt; (avec un URL/ligne) avec la ligne de commande :
   # bash traitement_url_base.sh &lt;URL.txt&gt;  &lt;tableauURL.html&gt; "&lt;motif recherché&gt;"
   
   #&lt;tableauURL.html&gt;  est le fichier de sortie du tableau HTML (ici il n'existe pas avant le lancement du script).
   #Il est nécéssaire d'avoir créer un dossier 'aspirations' dans le dossier d'utilisation du script.
   #===============================================================================
   # On attribue les fichiers en argument à des variables :
   
   fichier_urls=$1 # le fichier d'URL en entrée
   fichier_tableau=$2 # le fichier HTML en sortie
   motif=$3 # le motif recherché
   
   if [ $# -ne 3 ]
   then
      echo " Ce programme demande trois arguments."
      exit
   fi
   
   # On vérifie que le fichier d'URLs existe :
   if [ -f $1 ]
      then
         echo "Fichier OK"
      else
         echo "Ceci n'est pas un fichier valide."
         exit
   fi
   
   
   
   echo $fichier_urls;
   basename=$(basename -s .txt $fichier_urls)
   
   # On crée l'architecture HTML du tableau de sortie dans le fichier donné en second argument :
   #Déclaration de l'encodage et on associe Bulma pour la mise en forme CSS
   echo "&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset="UTF-8" /&gt;&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
   &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" /&gt;&lt;/head&gt;&lt;body&gt;" &gt; $fichier_tableau
   echo "&lt;h2&gt;Tableau $basename :&lt;/h2&gt;" &gt;&gt; $fichier_tableau
   echo "&lt;br/&gt;" &gt;&gt; $fichier_tableau
   echo "&lt;table class="table is-striped is-narrow is-hoverable is-fullwidth"&gt;" &gt;&gt; $fichier_tableau
   echo "&lt;tr&gt;&lt;th&gt;ligne&lt;/th&gt;&lt;th&gt;code&lt;/th&gt;&lt;th&gt;URL&lt;/th&gt;&lt;th&gt;encodage&lt;/th&gt;&lt;th&gt;dump&lt;/th&gt;&lt;th&gt;text&lt;/th&gt;&lt;th&gt;N°Occ&lt;/th&gt;&lt;th&gt;contextes&lt;/th&gt;&lt;th&gt;concordances&lt;/th&gt;&lt;/tr&gt;" &gt;&gt; $fichier_tableau
   # On crée un compteur pour les URLs/le nombre de lignes :               
   lineno=1;
   #
   while read -r line;
   do
   # On récupère l'URL (=la ligne)
       URL=$line
      # On récupère le code :
       CODEHTTP=$(curl -I -s $line | grep -e "^HTTP/" | grep -Eo "[0-9]{3}" | head -n1)	
      # On récupère l'encodage :
       ENC=$(curl -I -s $line | grep -Eo "charset=[\w-]+"| cut -d= -f2)
      # On récupère le contenu de la page HTML
      aspiration=$(curl $URL)
      # On met le contenu dans un document HTML dédié
      echo "$aspiration" &gt; "aspirations/$basename-$lineno.html"
   
      # On affiche les informations importantes dans le terminal
      #echo -e "\tURL : $URL";
      echo -e "\tURL N°: $lineno";
       echo -e "\tCode : $CODEHTTP";
   
      # Si ENC n'existe pas :
      if [[ ! $ENC ]]
      then
         # On définit l'encodage en UTF-8
         echo -e "\tEncodage non détecté, on prend UTF-8 par défaut.";
         ENC="UTF-8";
      # Sinon on garde l'encodage détécté
      else
         echo -e "\tEncodage : $ENC";
      fi
   
      # Si le code est égal à 200 :
      if [[ $CODEHTTP -eq 200 ]]                                                                                                                                         
      then 
         dump=$(lynx -dump -nolist -assume_charset=$ENC -display_charset=$ENC $URL)
         
         
         if [[ $ENC -ne "UTF-8" && -n "$dump" ]]
         # On vient convertir le fichier en UTF-8 grâce à iconv
            then
               dump=$(echo $dump | iconv -f $ENC -t UTF-8//IGNORE)
               
         fi
         
      
      # Si le code n'est pas 200, on ne récupère pas le contenu :	
      else
         echo -e "\tCode différent de 200, utilisation d'un dump vide."
         dump=""
         ENC=""
      fi
      echo "$dump" &gt; "./dumps-text/$basename-$lineno.txt"
      count=$(egrep -o -E $motif ./dumps-text/$basename-$lineno.txt| wc -l)
   
   contexte=$(echo "$dump"|grep -E -A2 -B2 $motif)
         echo "$contexte" &gt; "contextes/$basename-$lineno.txt" 
   
   
   bash concordance.sh ./dumps-text/$basename-$lineno.txt $motif &gt; ./concordances/$basename-$lineno.html
   echo "&lt;tr&gt;&lt;td&gt;$lineno&lt;/td&gt;&lt;td&gt;$CODEHTTP&lt;/td&gt;&lt;td&gt;&lt;
   a href=\"$URL\"&gt;$URL&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$ENC&lt;/td&gt;&lt;td&gt;&lt;
   a href="./aspirations/$basename-$lineno.html"&gt;html&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;
   a href="./dumps-text/$basename-$lineno.txt"&gt;text&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$count&lt;/td&gt;&lt;td&gt;&lt;
   a href="./contextes/$basename-$lineno.txt"&gt;contextes&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;
   a href="./concordances/$basename-$lineno.html"&gt;concordance&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;" &gt;&gt; $fichier_tableau
   lineno=$((lineno+1));
   
   done &lt; $fichier_urls               
   # On ferme le fichier HTML :
   echo "&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;" &gt;&gt; $fichier_tableau</code></pre><br>
   <p class="panel-heading">
      Développement
    </p>
    <br>       
    <p>Notre but premier a été de réaliser un script permettant de traiter nos listes d'URLs. Ce script doit permettre non seulement d'aspirer les contenus des pages webs choisies 
      mais aussi de réaliser des opérations de concordances (et de contextualisation si concordance il y a) mais aussi de collecter ces informations et de les 
      ranger dans des tableau HTML ce qui permet son insertion dans notre site.</p>
   <br>
    <p> Pour ce faire nous avons utilisé tout un ensemble de commandes bash vues en cours.</p>
   <br>
<p> Tout d'abord, nous avons téléchargé le <b>script traitement_url_base.sh</b> mis à notre disposition sur le Git du cours 
   puis nous avons installé <b>curl</b> qui nous permet d'aspirer le contenu des pages web et de compléter ce script.</p>
<br>
<p>Lorsque nous cherchons à aspirer une page web, il est important de savoir si l'aspiration fonctionne. C'est 
   ce sur quoi nous renseigne La commande <b>curl</b> nous a permis de récuperer l'entête de la reponse du serveur et donc de savoir si l'url etait valide ou non ! si c'est 200 c'est ok sinon non :c </p>
</br></br>
<img class="scripimage" src="images/Scripts/recupurl.png" width="70%"/>  
<br>
<p>Les entêtes qui nous ont interessées sont les suivantes :</p>
<div class="content">
<ul>
<li><b>Le code HTTP</b></li>
<li><b>Son encodage</b></li>
</ul>
</div>
<br>
<br>

<br>

<p>Lorsque le contenu de la page URL n'est pas de l'UTF-8 nous sommes embêtées , en effet le traitement d'une page non UTF-8 peut poser des problèmes pour la lecture des accents. Il nous paraît egalement fastidieux de traiter des pages n'ayant pas le même encodage. </p>
<p> Pour eviter les problèmes nous le convertissons avec iconv pour n'avoir que de l'UTF-8.</p>
</br></br><img class="scripimage" src="images/Scripts/enco1.png" width="70%"/>  

<br>


<br>
<p>Nos URLs vérifiées, nous voulons les stocker dans un tableau html afin d'avoir plus de visibilité et un recueil de données.</p>
<br>
<img class="scriptimg" src="images/Scripts/tablurl1.png"/>  
</br></br><p>fermeture du tableau html avec l'intégralité des donnéees :</p>
</br><img class="scripimage" src="images/Scripts/tablurl1.png" width="100%"/>  
<br>

<p>Après avoir traité nos URLs , nous avons pu passer à l'étape suivante: récupérer le contenu textuel de nos pages.</p>
<p> La commande <b>Lynx</b> nous permet de récuperer le contenu textuel d'une page </p>
</br></br></p> <img class="scripimage" src="images/Scripts/lynx.png" width="70%"/> </p>
<br>

<br>
<p>Le but de notre projet est d'analyser un ou plusieurs mots; ainsi nous avons commencé à nous soucier de ce mot. Nous avons ajouté un compteur permettant de compter le nombre d'occurences de nos mots dans les dumps</p>
</br></br><img class="scripimage" src="images/Scripts/count.png" width="70%"/>

<br>

           <br>

          

           <p> Pour stocker les aspirations, dumps, contextes nous avons crée des dossiers permettant de stocker ces données et également nécessaires au fonctionnement du script</p>
         </br></br> <img class="scripimage" src="images/Scripts/folder2.png" width="20%"/> 
          <br>
    
          
           <p>Le traitement de l'url ne sera pas le même en fonction de son entête. En effet s'il renvoit le code 200 nous allons incrémenter son dump à une variable. A contrario si l'URL renvoie un autre code nous utiliserons un dump vide.</p>
         </br></br>  <img class="scripimage" src="images/Scripts/entete.png" width="75%"/>  
           <br>
           <p>L' aspiration des pages et dumps textuels se font donc sur les URL ayant le code 200, ces données sont directement envoyées aux dossiers crées au préalable</p>
         </br></br> <img class="scripimage" src="images/Scripts/aspi.png" width="70%"/>
      </br></br> <img class="scripimage" src="images/Scripts/dump.png" width="70%"/>
           <br>
           
           <p>Pour ajouter le contexte du motif inséré par l'utilisateur , nous nous sommes documentés sur la manuel de 'grep' nous pouvons voir que les options A et B suivies d'un chiffre permettent de trouver ce qu'il y a après le mot et avant " after, before" le chiffre permet de mentionner la longueur de contexte que nous voulons en ligne.</p>
         </br></br>    <img class="scripimage" src="images/Scripts/contexte.png" width="70%"/>
           <br>
           <p class="panel-heading">
               Script Concordance
             </p>
             <h3 class="quote">Script en entier pour la concordance</h3>

             <pre style=" height: 500px; width: 900px; display: block;
             margin-left: auto;
             margin-right: auto;"><code class="bash">#!/usr/bin/bash


               fichier_text=$1
               motif=$2
               
               if [[ $# -ne 2 ]]
               then
                  echo "Ce programme demande exactement deux arguments."
                  exit
               fi
               
               if [[ ! -f $fichier_text ]]
               then
                 echo "le fichier $fichier_text n'existe pas"
                 exit
               fi
               
               if [[ -z $motif ]]
               then
                 echo "le motif est vide"
                 exit
               fi
               
               echo "
               
               &lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=UTF-8 /&gt;&lt;meta name=viewport content=width=device-width, initial-scale=1&gt;
               &lt;link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css /&gt;&lt;/head&gt;&lt;body&gt;
                   &lt;div class="table-container"&gt;
                   &lt;table class="table is-striped is-narrow is-hoverable is-fullwidth"&gt;
               &lt;html lang=\"en\"&gt;
               &lt;head&gt;
                 &lt;meta charset=\"UTF-8\"&gt;
                 &lt;title&gt;Concordance&lt;/title&gt;
               &lt;/head&gt;
               &lt;body&gt;
               
               &lt;thead&gt;
                 &lt;tr&gt;
                   &lt;th class=\"has-text-right\"&gt;Contexte droit&lt;/th&gt;
                   &lt;th&gt;Cible&lt;/th&gt;
                   &lt;th class=\"has-text-left\"&gt;Contexte gauche&lt;/th&gt;
                 &lt;/tr&gt;
               &lt;/thead&gt;
               &lt;tbody&gt;
               "
               
               grep -E -o "(\w+\W+){0,5}\b$motif\b(\W+\w+){0,5}" $fichier_text | sed -E "s/(.*)($motif)(.*)/&lt;tr&gt;&lt;td&gt;\1&lt;\/td&gt;&lt;td&gt;\2&lt;\/td&gt;&lt;td&gt;\3&lt;\/td&gt;&lt;\/tr&gt;/"
               
               echo "
               &lt;/tbody&gt;
               &lt;/table&gt;
               &lt;/body&gt;
               &lt;/html&gt;
               "</code></pre>
             <h3 class="quote">Développement</h3>
           
             <p>Suite à nos aspirations nous voulons créer un concordancier qui nous permettra de voir le contexte droit et gauche du motif.</p>
             <p>Pour ce faire, nous utilisons la commande bash ci-dessous qui nous permet de lancer notre futur script de concordancier</p>
            </br></br>    <img class="scripimage" src="images/Scripts/bash.png" width="100%"/>  
         </br></br> <p>Nous pouvons voir un fait intéressant dans la dernière partie de la commande : </p>
            </br></br>   <img class="scripimage" src="images/Scripts/folderconcor.png" width="110%"/> 
         </br></br>  <p> Les données du script concordances seront envoyées dans un fichier nommé <i>concordance</i>.
             Il est donc primordial de créer ce dossier.</p>
            </br></br>    <img class="scripimage" src="images/Scripts/folder.png" width="20%"/>  
         </br></br>  <p>Ce script contiendra deux arguments , le premier est le fichier dump : c'est sur ce ficher que se produira l'analyse du contexte du motif, le deuxième argument est le motif utilisé sur le scriptaspi.</p>
             <p>Pour éviter les problèmes nous mettons la condition d'avoir 2 arguments pour lancer le script.
            </br></br>   <img class="scripimage" src="images/Scripts/arg.png" width="50%"/>  
         </br></br>  <p>Nous voulons les résultats sous forme de tableaux. Pour cette raison dans le script concordance nous allons faire un tableau html.</p>
            </br></br>   <img class="scripimage" src="images/Scripts/tableauhtml.png" width="100%"/>  
         </br></br>   <p>Afin de mettre en forme le contexte droit et gauche nous utilisons la commande ci-dessous :</p>
         </br></br>   <img class="scripimage" src="images/Scripts/concordanceregex.png" width="110%"/>  
      </br></br>   <p>Avec la fonction grep nous captons le contexte gauche du motif à l'aide d'une expresion régulière <i>(\w+\W+){0,5}</i> de même pour le contexte droit.</p>
             <p>Suite à cela nous avons le contexte droit et gauche. Maintenant il faut l'ajouter à notre tableau de manière ordonnée.</p>
             <p>Maintenant intéressons nous à la deuxieme partie de la commande:</p>
            </br></br>   <img class="scripimage" src="images/Scripts/sed.png" width="110%"/> 
         </br></br>  <p>Nous mettons 3 élèment entre parenthèse.</p> 
             <p>Les parenthèses nous permettent de compléter notre tableau comme nous le voulons. En effet le contenu de la première partie peut être extrait en l'appelant 1, le deuxième élément qui est le motif sera deux , enfin la parenthèse se trouvant à sa gauche sera 3.</p>
             <p>Nous répartissons ces chiffres dans les colonnes du tableau en sachant que 1 est le contexte gauche , 2 le motif puis 3 le contexte droit.</p>
             <p>Une fois cela fait nous avons notre concordancier qui a cet aspect :</p>
            </br></br>   <img class="scripimage" src="images/Scripts/aspectconcor.png" width="40%"/> 
           
           <br>
       
    <br>
</div>
</div>
 <div class="column">
</div>
</div></p>
</div>
   

   <!-- Main jQuery -->
   <script src="plugins/jquery/jquery.js"></script>
   <script src="js/contact.js"></script>
   <!--  Magnific Popup-->
   <script src="plugins/magnific-popup/dist/jquery.magnific-popup.min.js"></script>
   <!-- Slick Slider -->
   <script src="plugins/slick-carousel/slick/slick.min.js"></script>
   <!-- Counterup -->
   <script src="plugins/counterup/jquery.waypoints.min.js"></script>
   <script src="plugins/counterup/jquery.counterup.min.js"></script>
   <script src="plugins/shuffle/shuffle.min.js"></script>
   <script src="plugins/aos/aos.js"></script>
   <script src="plugins/animate-css/wow.min.js"></script>
   <script src="plugins/modal-video/jquery-modal-video.min.js"></script>

   <!-- Google Map -->
   <script src="plugins/google-map/map.js"></script>
   <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkeLMlsiwzp6b3Gnaxd86lvakimwGA6UA&callback=initMap"></script>    

   <script src="js/script.js"></script>

</body></html>
